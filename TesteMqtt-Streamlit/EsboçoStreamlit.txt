EsboÃ§o Streamlit


Assinar o tÃ³pico MQTT do seu ESP32

Receber os dados JSON do sensor BMP280

Exibir os dados em tempo real em uma dashboard interativa

ğŸ› ï¸ Requisitos

Antes, vocÃª precisa instalar alguns pacotes no seu ambiente Python:

pip install streamlit paho-mqtt

ğŸ“„ Estrutura do projeto

Crie um arquivo chamado, por exemplo:
dashboard_bmp280.py

âœ… CÃ³digo Python com Streamlit + MQTT
import streamlit as st
import paho.mqtt.client as mqtt
import json
from datetime import datetime

# Dados recebidos
temperaturas = []
pressoes = []
tempos = []

# ConfiguraÃ§Ãµes do broker MQTT (local)
MQTT_BROKER = "localhost"  # ou "192.168.0.100" se rodar em outro PC
MQTT_PORT = 1883
MQTT_TOPIC = "sensor/bmp280"

# --- FunÃ§Ã£o chamada quando recebe mensagem MQTT ---
def on_message(client, userdata, msg):
    try:
        data = json.loads(msg.payload.decode())
        temperatura = data.get("temperatura")
        pressao = data.get("pressao")
        agora = datetime.now().strftime("%H:%M:%S")

        if temperatura and pressao:
            temperaturas.append(temperatura)
            pressoes.append(pressao)
            tempos.append(agora)

            # Limita o tamanho das listas para manter leve
            if len(tempos) > 100:
                temperaturas.pop(0)
                pressoes.pop(0)
                tempos.pop(0)
    except Exception as e:
        print(f"Erro ao processar mensagem: {e}")

# --- Configura e conecta MQTT ---
client = mqtt.Client()
client.on_message = on_message
client.connect(MQTT_BROKER, MQTT_PORT, 60)
client.subscribe(MQTT_TOPIC)
client.loop_start()

# --- Interface do Streamlit ---
st.set_page_config(page_title="Monitor BMP280", layout="wide")
st.title("ğŸ“¡ Dashboard BMP280 via MQTT")

col1, col2 = st.columns(2)
with col1:
    st.metric("ğŸŒ¡ï¸ Temperatura (Â°C)", temperaturas[-1] if temperaturas else "â€”")
with col2:
    st.metric("ğŸ§­ PressÃ£o (hPa)", pressoes[-1] if pressoes else "â€”")

st.line_chart(
    data={
        "Temperatura (Â°C)": temperaturas,
        "PressÃ£o (hPa)": pressoes,
    },
    x=tempos
)

# Atualiza a cada 2 segundos
st.experimental_rerun()

â–¶ï¸ Como rodar

Com o Mosquitto rodando e o ESP32 publicando, execute:

streamlit run dashboard_bmp280.py


O Streamlit abrirÃ¡ no navegador (geralmente em http://localhost:8501) e vocÃª verÃ¡:

MÃ©tricas em tempo real

GrÃ¡ficos dinÃ¢micos de temperatura e pressÃ£o

ğŸ§  Dicas finais

Se o broker estiver em outro PC â†’ altere "localhost" para o IP dele.

Se os dados nÃ£o aparecerem:

Verifique se o ESP estÃ¡ conectado corretamente

Use mosquitto_sub para garantir que estÃ¡ enviando ao tÃ³pico certo

O grÃ¡fico vai acumulando os dados. Para limitar histÃ³rico, ajuste os .pop(0) ou use pandas com janela de tempo.